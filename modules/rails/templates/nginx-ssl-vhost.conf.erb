server {
  listen 443 default;
  <% if @domain == 'vagrant.vm' %>
    listen 8091;
  <% end %>

  ssl on;
  ssl_certificate /var/lib/puppet/ssl/certs/<%= fqdn %>.pem;
  ssl_certificate_key /var/lib/puppet/ssl/private_keys/<%= fqdn %>.pem;

  root /u/apps/<%= @app_name %>/current/public;

  location / {
    try_files $uri/index.html $uri.html $uri @<%= @app_name %>;
  }

  location @<%= @app_name %> {
    proxy_pass http://<%= @app_name %>_<%= @hostname %>_<%= @rails_env %>;
  }
}
