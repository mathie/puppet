server {
  listen 80 default;

  root /opt/graphite/webapp/content;

  auth_basic 'Rubaidh Ops';
  auth_basic_user_file /etc/nginx/htpasswd;

  location /media/ {
    root /usr/lib/python2.7/dist-packages/django/contrib/admin/media;
  }

  location / {
    try_files $uri/index.html $uri.html $uri @graphite_web;
  }

  location @graphite_web {
    proxy_pass http://graphite_web;
  }
}
